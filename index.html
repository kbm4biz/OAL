<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Report Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e3f2fd;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      width: 90%;
      max-width: 400px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
      position: relative;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin: 15px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1em;
    }
    button {
      width: 100%;
      padding: 10px;
      background-color: #2196f3;
      border: none;
      border-radius: 4px;
      color: white;
      font-size: 1em;
      cursor: pointer;
    }
    button:hover {
      background-color: #1976d2;
    }
    #loading-container, #response-container {
      display: none;
    }
    .report-link {
      display: block;
      margin: 20px 0;
      color: #2196f3;
      text-decoration: none;
      word-break: break-all;
    }
    .report-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container" id="form-container">
    <h2>Student Report Generator</h2>
    <form id="student-form">
      <input type="text" id="studentId" name="studentId" 
             placeholder="Enter Student ID" required
             pattern="\d+" title="Please enter numbers only">
      <button type="submit">Generate Report</button>
    </form>
  </div>

  <div class="container" id="loading-container">
    <h2>Processing Your Request</h2>
    <p>Please wait while we generate your report...</p>
  </div>

  <div class="container" id="response-container">
    <h2>Report Ready</h2>
    <div id="response-content"></div>
    <button onclick="showForm()">New Report</button>
  </div>

  <script>
    const containers = {
      form: document.getElementById('form-container'),
      loading: document.getElementById('loading-container'),
      response: document.getElementById('response-container')
    };

    const responseContent = document.getElementById('response-content');
    const form = document.getElementById('student-form');

    // Replace with your actual Power Automate Flow endpoint URL
    const FLOW_URL = 'https://prod-208.westeurope.logic.azure.com:443/workflows/8229f59b7cca41a0b08627bdf2295a0a/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=IAkb9M6kQOlJxtbx-tlELeVQkWKAE8rbh0QwjUXSQlU';

    async function submitStudentId(studentId) {
      try {
        const response = await fetch(FLOW_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ studentId })
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        
        const data = await response.json();
        if (!data?.reportUrl) throw new Error('Invalid response from server');
        
        return data.reportUrl;
      } catch (error) {
        console.error('Submission error:', error);
        throw new Error('Failed to generate report. Please try again.');
      }
    }

    function showForm() {
      containers.response.style.display = 'none';
      containers.form.style.display = 'block';
      form.reset();
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const studentId = document.getElementById('studentId').value.trim();

      // UI state updates
      containers.form.style.display = 'none';
      containers.response.style.display = 'none';
      containers.loading.style.display = 'block';
      responseContent.innerHTML = '';

      try {
        const reportUrl = await submitStudentId(studentId);
        
        responseContent.innerHTML = `
          <p>Your report is ready!</p>
          <a href="${reportUrl}" class="report-link" target="_blank">View Report</a>
        `;
      } catch (error) {
        responseContent.textContent = error.message;
      } finally {
        containers.loading.style.display = 'none';
        containers.response.style.display = 'block';
      }
    });
  </script>
</body>
</html>
