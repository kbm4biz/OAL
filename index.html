<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
  <title>منصة الارشاد الرقمي</title>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2196F3">
  
  <style>
    /* All original CSS remains unchanged */
    :root {
      --primary: #2196F3;
      --success: #4CAF50;
      --error: #f44336;
      --warning: #ff9800;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #fafafa;
      max-width: 600px;
      margin: 2rem auto;
      padding: 0 1rem 100px; /* Increased bottom padding for footer */
      direction: rtl;
      position: relative;
    }
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      padding: 0.75rem 1rem;
      text-align: center;
      font-size: 0.9rem;
      border-top: 1px solid #ddd;
      z-index: 2;
      display: flex;
      justify-content: space-around; /* Changed for better spacing */
      align-items: center;
      flex-wrap: wrap; /* Allow wrapping on small screens */
    }
    
    /* NEW: Style for the install button */
    #installBtn {
        background-color: var(--success);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s;
    }
    #installBtn:hover {
        transform: scale(1.05);
    }

    /* All other original CSS... */
    .platform-header{text-align:center;color:var(--primary);margin:1rem 0;font-size:2rem;font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,0.1)}.card{background:white;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);padding:2rem;margin:1rem auto;width:100%;box-sizing:border-box;position:relative;z-index:1}.emoji-background{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;overflow:hidden}.emoji-scroll{position:absolute;animation:scrollUp 20s linear infinite;opacity:.2;font-size:1.5rem;user-select:none}.emoji-scroll img{display:inline-block;vertical-align:middle}@keyframes scrollUp{from{transform:translateY(100vh)}to{transform:translateY(-100%)}}.form-group{margin-bottom:1.5rem;text-align:center}label{display:block;margin-bottom:.5rem;font-weight:500}input{width:100%;max-width:400px;padding:.75rem;border:1px solid #ddd;border-radius:4px;font-size:1rem;margin:0 auto .5rem;display:block;text-align:right}button{background:var(--primary);color:white;border:none;padding:.75rem 1.5rem;border-radius:4px;cursor:pointer;font-size:1rem;transition:opacity .2s;display:block;margin:1rem auto;width:200px;max-width:100%}button:disabled{background:#ccc;cursor:not-allowed}.response-container{margin-top:1.5rem;display:none;text-align:center}.status{padding:1rem;border-radius:4px;margin:1rem 0;background:#fff}.status.success{background:#e7f8e9}.status.error{background:#fdebec}.status.warning{background:#fff7e5}@media (max-width:480px){.card{padding:1rem}.platform-header{font-size:1.5rem}h1{font-size:1.2rem}button{width:100%;padding:.75rem}.footer{flex-direction:column;gap:.5rem;padding:.75rem}}.scrolling-gear{display:inline-block;animation:spin 10s linear infinite;margin-left:10px}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}.news-banner{background:red;color:white;padding:10px 0;text-align:center;font-weight:bold;overflow:hidden;white-space:nowrap;position:fixed;top:0;left:0;width:100%;z-index:3}.news-banner p{display:inline-block;padding-left:100%;animation:scrollLeft 20s linear infinite;animation-fill-mode:both;will-change:transform;margin:0}@keyframes scrollLeft{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}#formDisabledMessage{text-align:center;color:var(--error);font-weight:bold;margin:2rem 0;padding:1rem;background:#fdebec;border-radius:8px}
  </style>
  <script>
    // All configuration flags remain the same
    const ENABLE_FORM = true;
    const ENABLE_BANNER = false;
    // ... and so on
  </script>
</head>
<body>
  <div id="newsBanner" class="news-banner"><p></p></div>
  <h2 class="platform-header">منصة الارشاد الرقمي</h2>
  <div class="emoji-background" id="emojiContainer"></div>
  <div class="card">
    <h1>إنشاء الملخص الشامل للمتدرب </h1>
    <form id="reportForm"></form>
    <div id="formDisabledMessage" style="display:none;">
        الخدمة متوقفة حالياً للصيانة، الرجاء المحاولة في وقت لاحق.
    </div>
    <div class="response-container" id="responseContainer"></div>
  </div>

  <footer class="footer">
    <span>فكره واعداد خالد الأيداء</span>
    <button id="installBtn" style="display: none;">تثبيت التطبيق</button>
    <span id="timestamp"></span>
  </footer>

  <script>
    // NEW: PWA Installation and Service Worker Logic
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent the mini-infobar from appearing on mobile
      e.preventDefault();
      // Stash the event so it can be triggered later.
      deferredPrompt = e;
      // Update UI to notify the user they can install the PWA
      installBtn.style.display = 'block';
      console.log(`'beforeinstallprompt' event was fired.`);
    });

    installBtn.addEventListener('click', async () => {
      // Hide the app provided install promotion
      installBtn.style.display = 'none';
      // Show the install prompt
      deferredPrompt.prompt();
      // Wait for the user to respond to the prompt
      const { outcome } = await deferredPrompt.userChoice;
      console.log(`User response to the install prompt: ${outcome}`);
      // We've used the prompt, and can't use it again, throw it away
      deferredPrompt = null;
    });

    window.addEventListener('appinstalled', () => {
        // Hide the install button
        installBtn.style.display = 'none';
        // Clear the deferredPrompt so it can be garbage collected
        deferredPrompt = null;
        console.log('PWA was installed');
    });

    // Register the service worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
            .then(registration => {
                console.log('Service Worker registered: ', registration);
            })
            .catch(registrationError => {
                console.log('Service Worker registration failed: ', registrationError);
            });
        });
    }

    // All your other application logic (form handling, GPS, etc.) goes below
    const form = document.getElementById('reportForm');
    // ... The rest of your script remains here, unchanged.
  </script>
</body>
</html>
